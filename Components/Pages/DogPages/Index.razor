@page "/dogs"

@rendermode InteractiveServer

@using Microsoft.EntityFrameworkCore
@using Microsoft.AspNetCore.Components.QuickGrid
@using DogAdoption.Models
@using DogAdoption.Data
@implements IAsyncDisposable
@inject IDbContextFactory<DogAdoption.Data.DogAdoptionContext> DbFactory

<PageTitle>Index</PageTitle>

<h1>Index</h1>

<p>
    <a href="dogs/create">Create New</a>
</p>

<table class="content-table">
    <thead>
        <tr>
            <th>Image:</th>
            <th>Name:</th>
            <th>Breed:</th>
        </tr>
    </thead>
    @foreach(var item in myDogs){
        <tr>
            <td>
                <img src=@item.ImageURL alt="myDog" style="width:150px; height:150px;" />
            </td>
            <td>
                @item.DogName
            </td>
            <td>
                @item.DogBreed
            </td>
            <td>
                @item.DogWeight
            </td>
        </tr>
    }

    </table>

    <style>
        .content-table{
            border-collapse: collapse;
            margin: 35px 0;
            min-width: 900px;
        }
        .content-table thead tr{
            background-color: #009879;
            color: whitesmoke;
            text-align: left;
            font-weight: bold;
        }
        .content-table th, .content-table td{
            padding: 12px 15px;
        }
    </style>

    <QuickGrid Class="table" Items="context.Dog">
        <PropertyColumn Property="dog => dog.ImageURL" Title ="Image" />
        <PropertyColumn Property="dog => dog.DogName" />
        <PropertyColumn Property="dog => dog.DogAge" />
        <PropertyColumn Property="dog => dog.DogWeight" />
        <PropertyColumn Property="dog => dog.DogBreed" />
        <PropertyColumn Property="dog => dog.IsMale" />
        <PropertyColumn Property="dog => dog.IsVaccinated" />
        <PropertyColumn Property="dog => dog.IsNeutered" />
        <PropertyColumn Property="dog => dog.Temperament" />


        <TemplateColumn Context="dog">
            <template>
                <img src="@dog.ImageURL" alt="dog image" style="width: 500px; height : 500px;" />
            </template>
            <a href="@($"dogs/edit?dogid={dog.DogID}")">Edit</a> |
            <a href="@($"dogs/details?dogid={dog.DogID}")">Details</a> |
            <a href="@($"dogs/delete?dogid={dog.DogID}")">Delete</a>
        </TemplateColumn>
    </QuickGrid>

    @code {
        private DogAdoptionContext context = default!;
        public List<Dog> myDogs;
        protected override void OnInitialized()
        {
            context = DbFactory.CreateDbContext();
            myDogs = context.Dog.ToList();
        }

    public async ValueTask DisposeAsync() => await context.DisposeAsync();
}
