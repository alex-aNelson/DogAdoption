@page "/dogs"

@rendermode InteractiveServer

@using Microsoft.EntityFrameworkCore
@using Microsoft.AspNetCore.Components.QuickGrid
@using DogAdoption.Models
@using DogAdoption.Data
@implements IAsyncDisposable
@inject IDbContextFactory<DogAdoption.Data.DogAdoptionContext> DbFactory

<PageTitle>Available Dogs</PageTitle>

<h1 id="header">Available Dogs</h1>
<p>
    <a href="dogs/create">Create New</a>
</p>


<div id="form">
<form action="/dogs" data-enhance>
    <input type="search" name="NameFilter" />

    <input type="submit" value="Search by Name" />
</form>
&nbsp;&nbsp;
<form action="/dogs" data-enhance>
    <input type="search" name="BreedFilter" />
    <input type="submit" value="Search by Breed" />
</form>
</div>

<style>
    #header{
        text-align:center;
    }
    #form {
        display: flex;
        flex-direction: column;
        align-items: center; /* Centers forms horizontally */
        margin-top: 20px; /* Adds spacing from the top of the page */
        gap: 10px; /* Adds spacing between the two forms */
    }

    form {
        display: flex;
        gap: 5px; /* Adds spacing between input fields and buttons */
    }

    body {
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh; /* Full height viewport */
        font-family: Arial, sans-serif;
    }
</style>

<br />
<br />
<table class="content-table">
    <thead> 
        <tr> 
            <th>Image:</th> 
            <th>Name:</th> 
            <th>Breed:</th> 
            <th>Weight:</th>
            <th>Vaccinated:</th>
            <th>Neutered:</th>
        </tr> 
    </thead> 
    <tbody> 
        @foreach (var item in DogList)
        {
            <tr>
                <td>
                    <img src=@item.ImageURL alt="myDog" style="width:150px; height:150px;" />
                </td>
                <td>
                    @item.DogName
                </td>
                <td>
                    @item.DogBreed
                </td>
                <td>
                    @item.DogWeight
                </td>

                <td>
                    @item.IsVaccinated
                </td>
                <td>
                    @item.IsNeutered
                </td>
                <td>
                    <a href="@($"/dogs/details?dogid={item.DogID}")" class="btn btn-primary">Details</a>
                </td>
                <td>
                    <a href="@($"/adoptionapplications/create?dogid={item.DogID}")" class="btn btn-primary">Adopt Me!</a>
                </td>

            </tr>
        }
    </tbody> 

</table>

<style>
    .content-table {
    border-collapse: collapse;
    min-width: 900px;
        margin: 0 auto; 
    }

    .content-table-container {
        display: flex;
        justify-content: center;
        margin-top: 20px; 
        width: 100%; 
    }

    .content-table thead tr {
    background-color: #009879;
    color: whitesmoke;
    text-align: left;
    font-weight: bold;
    }

    .content-table th, .content-table td {
    padding: 12px 15px;
    }

    .content-table tbody tr {
    border-bottom: 1px solid #dddddddd
    }

    .content-table tbody tr:nth-of-type(even) {
    background-color: #f3f3f3
    }

    .content-table tbody tr: last-of-type {
    border-bottom: 2px solid #009879;
    }
</style>

<QuickGrid Class="table" Items="context.Dog">
    <PropertyColumn Property="dog => dog.ImageURL" Title="Image" />

    <PropertyColumn Property="dog => dog.DogName" />
    <PropertyColumn Property="dog => dog.DogAge" />
    <PropertyColumn Property="dog => dog.DogWeight" sortable="true" />
    <PropertyColumn Property="dog => dog.DogBreed" />
    <PropertyColumn Property="dog => dog.IsMale" />
    <PropertyColumn Property="dog => dog.IsVaccinated" />
    <PropertyColumn Property="dog => dog.IsNeutered" />
    <PropertyColumn Property="dog => dog.Temperament" />


    <TemplateColumn Context="dog">
        <template>
            <img src="@dog.ImageURL" alt="dog image" style="width: 500px; height : 500px;" />
        </template>
        <a href="@($"dogs/edit?dogid={dog.DogID}")">Edit</a> |
        <a href="@($"dogs/details?dogid={dog.DogID}")">Details</a> |
        <a href="@($"dogs/delete?dogid={dog.DogID}")">Delete</a>
    </TemplateColumn>
</QuickGrid>

@code {

    [Parameter]
    [SupplyParameterFromQuery]
    public string? NameFilter { get; set; }
    [Parameter]
    [SupplyParameterFromQuery]
    public string? BreedFilter { get; set; }


    public IQueryable<Dog> DogList => context.Dog
        .Where(d => (string.IsNullOrEmpty(NameFilter) || d.DogName!.Contains(NameFilter))
                 && (string.IsNullOrEmpty(BreedFilter) || d.DogBreed!.Contains(BreedFilter)));

    private DogAdoptionContext context = default!;

    protected override void OnInitialized()
    {
        context = DbFactory.CreateDbContext();

    }

    


    public async ValueTask DisposeAsync() => await context.DisposeAsync();
}
